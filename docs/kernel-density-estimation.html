<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Kernel Density Estimation | Old Notes, Musings, and Miscellany" />
<meta property="og:type" content="book" />


<meta property="og:description" content="Old notes, musings, and miscellany" />
<meta name="github-repo" content="zief0002/musings" />

<meta name="author" content="Andrew Zieffler" />

<meta name="date" content="2020-03-23" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Old notes, musings, and miscellany">

<title>Kernel Density Estimation | Old Notes, Musings, and Miscellany</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="style/style.css" type="text/css" />
<link rel="stylesheet" href="style/table-styles.css" type="text/css" />
<link rel="stylesheet" href="style/syntax.css" type="text/css" />
<link rel="stylesheet" href="style/navbar.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#foreword">Foreword</a></li>
<li><a href="introduction.html#introduction">Introduction</a></li>
<li><a href="creating-tables-to-present-statistical-results.html#creating-tables-to-present-statistical-results">Creating Tables to Present Statistical Results</a></li>
<li><a href="kernel-density-estimation.html#kernel-density-estimation">Kernel Density Estimation</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="kernel-density-estimation" class="section level1">
<h1>Kernel Density Estimation</h1>
<p>Adapted from <span class="citation">Zieffler et al. (<a href="#ref-Zieffler:2011">2011</a>)</span></p>
<p><br /><br /></p>
<p>In 1986, the Vietnamese government began a policy of <em>doi moi</em> (renovation) and decided to move from a centrally planned command economy to a “market economy with socialist direction.” As a result, Vietnam was able to evolve from near famine conditions in 1986 to a position as the world’s third largest exporter of rice in the mid-1990s. Between 1992 and 1997 Vietnam’s gross domestic product (GDP) rose by 8.9% annually <span class="citation">(WorldBank, <a href="#ref-worldbank">1999</a>)</span>.</p>
<p>The first Vietnam Living Standards Survey (VLSS) was conducted in 1992–93 by the State Planning Committee (SPC) (now Ministry of Planning and Investment) along with the General Statistical Office (GSO). The second VLSS was conducted by the GSO in 1997–98. The survey was part of the Living Standards Measurement Study (LSMS) that was conducted in a number of developing countries with technical assistance from the World Bank.</p>
<p>The second VLSS was designed to provide an up-to-date source of data on households to be used in policy design, monitoring of living standards, and evaluation of policies and programs. One part of the evaluation was whether the policies and programs that were currently available were age appropriate for the population. For example, if a country has a higher proportion of older people, then there needs to be programs available that appeal to that sector of the population. Another concern was whether the living standards for different sections of the country were equitable.</p>
<p>Given the background above, data from the second VLSS (available in the <a href="https://raw.githubusercontent.com/zief0002/musings/master/data/vlss-age.csv">vlss-age.csv</a> data set) is used to examine the following research question:</p>
<blockquote>
<p>What is the age distribution for the Vietnamese population?</p>
</blockquote>
<p>To address this research question, we will use kernel density estimation to visually explore the age distribution in the sample data.</p>
<p><br /><br /></p>
<div id="loading-packages-and-importing-the-data" class="section level2">
<h2>Loading Packages and Importing the Data</h2>
<p>To begin, we will load three packages that we will use in this analysis.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Load libraries</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(quantreg)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<p>The <a href="https://raw.githubusercontent.com/zief0002/musings/master/data/vlss-age.csv">vlss-age.csv</a> data contains the ages of 28,633 individuals (in years ranging from 0 to 99). We will import this data using the <code>read_csv()</code> function from the <strong>readr</strong> package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Import data</span></a>
<a class="sourceLine" id="cb2-2" title="2">vlss =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/zief0002/musings/master/data/vlss-age.csv&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">head</span>(vlss)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##      ID   Age
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1    68
## 2     2    70
## 3     3    31
## 4     4    28
## 5     5    22
## 6     6     7</code></pre>
<p><br /><br /></p>
</div>
<div id="nonparametric-density-estimation" class="section level2">
<h2>Nonparametric Density Estimation</h2>
<p>Density estimation is one of the most useful methods for examining sample distributions. Nonparametric density estimation is an approach to estimating the distribution of the population from which the sample was drawn. This allows the observed sample data to provide insight into the structure of the unknown probability distribution underlying the population. The density estimation is nonparametric in the sense that the sample data suggest the shape, rather than imposing the shape of a known population distribution with particular values of its parameters.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-3"></span>
<img src="04-kde_files/figure-html/unnamed-chunk-3-1.png" alt="Histogram of the age distribution." width="50%" />
<p class="caption">
Figure 1: Histogram of the age distribution.
</p>
</div>
<p>In the past, it was common for behavioral scientists to use a histogram to estimate the population density. A histogram is one of the simplest nonparametric estimators of a population density. Histograms, usually displayed as a graph, are essentially enumerations, or counts, of the observed data for each of a number of disjoint categories, or bins. Despite the popularity of the histogram, it has a number of drawbacks that suggest it is not always the best method to use.</p>
<p>The bin width—which is often chosen by the software rather than the researcher—has a great deal of influence on the shape of the histogram, and thus, on the inferences made by the researcher. Most methods for creating histograms partition the observed data into equally spaced bins using algorithms that typically focus on producing the optimal bin count given the observed data <span class="citation">(Freedman &amp; Diaconis, <a href="#ref-freedman">1981</a>; Scott, <a href="#ref-scott">1979</a>; Sturges, <a href="#ref-sturges">1926</a>)</span>. These methods often have strong assumptions about the shape of the underlying population distribution.</p>
<p>For example, when distributions are strongly skewed, the density estimate produced by the histogram may be misleading, since several of the bins chosen in the optimization process can have very little data <span class="citation">(e.g., Rissanen et al., <a href="#ref-rissanen">1992</a>)</span>. While there have been methodological advances in selecting the bin width in a histogram <span class="citation">(e.g., Wand, <a href="#ref-wand2">1997</a>)</span>, histograms are still essentially modeling the data using discontinuous step functions. These functions assume gaps in the underlying population density (i.e., a certain discontinuity or discreteness) when the graph of the function jumps to each new <em>x</em>-value. So, if the researcher believes that the observed sample data comes from a population with a continuous density, then other estimation methods are preferable. Fortunately, there are substantially better methods of estimating populations with a continuous density.</p>
<p><br /><br /></p>
</div>
<div id="kernel-density-estimators" class="section level2">
<h2>Kernel Density Estimators</h2>
<p>A much better estimate of the population density for continuous variables can be obtained by using kernel methods. Nonparametric kernel density estimation can be thought of as a method of averaging and smoothing the density estimate provided by the histogram. More formally, kernel density estimation is a sophisticated form of locally weighted averaging of the sample distribution.</p>
<p>Kernel density estimation works by estimating the density at each observation, <em>x</em>, using a smooth, weighted function, known as a <em>kernel</em>. The figure below shows a conceptual illustration of kernel density estimation <span class="citation">(adapted from Sain, <a href="#ref-sain">1994</a>)</span>. The vertical lines below the axis represent the <span class="math inline">\(N=6\)</span> sample observations. The dashed lines represent the Gaussian kernel function, and the solid line represents the overall density estimate. The smoothing parameter, represented by the variation in each distribution, is fixed (i.e., it is the same value in each kernel).</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-4"></span>
<img src="figs/fig-03-01.png" alt="Illustration of the kernel density estimation (solid line) for *N=6* observations (vertical lines). A Gaussian kernel function (dashed lines) with a fixed smoothing parameter was centered at each observation. The figure was adapted from Sain (1994)." width="50%" />
<p class="caption">
Figure 2: Illustration of the kernel density estimation (solid line) for <em>N=6</em> observations (vertical lines). A Gaussian kernel function (dashed lines) with a fixed smoothing parameter was centered at each observation. The figure was adapted from Sain (1994).
</p>
</div>
<p>In the figure, the kernel function is the normal, or Gaussian, distribution.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Each kernel function is centered at one of the <span class="math inline">\(N=6\)</span> observations and identically scaled. An estimate of the overall density can then be found by summing the height of all the kernel densities at each observation.</p>
<p>Note that the variation (width) in the kernel determines the amount of overlap at each observed value. Skinnier kernels have less overlap resulting in a smaller overall sum, while wider kernels would result in more overlap and a larger sum. The data analyst not only specifies the kernel function, but also the variation in the kernel function. The kernel density illustration shows a visual depiction of the variation in the kernel functions based on the half-width of the kernel (i.e., half the width of each kernel). This is also referred to as the <em>smoothing parameter</em> since it has a direct impact on the overall smoothness of the plot.</p>
<p><br /><br /></p>
</div>
<div id="plotting-a-kernel-density-estimate" class="section level2">
<h2>Plotting a Kernel Density Estimate</h2>
<p>To plot a kernel density estimate of a distribution, we will use the <code>geom_density()</code> function from the <strong>ggplot2</strong> package. This package is loaded when the <strong>tidyverse</strong> package is loaded.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Load library</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># Create density plot</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="kw">ggplot</span>(<span class="dt">data =</span> vlss, <span class="kw">aes</span>(<span class="dt">x =</span> Age)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Density&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-5"></span>
<img src="04-kde_files/figure-html/unnamed-chunk-5-1.png" alt="Kernel density plot of the age distribution using the default (Gaussian) kernel." width="50%" />
<p class="caption">
Figure 3: Kernel density plot of the age distribution using the default (Gaussian) kernel.
</p>
</div>
<p>Changing either the kernel function or the smoothing parameter affects the overall density that is estimated. There are several kernel functions that can be used in R. You can change the kernel function by adding the <code>kernel=</code> argument to <code>geom_density()</code> layer. For example, to use the Epanechnikov kernel, we would add <code>kernel="epanechnikov"</code> to the <code>geom_density()</code> layer.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Change kernel function</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> vlss, <span class="kw">aes</span>(<span class="dt">x =</span> Age)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">kernel=</span><span class="st">&quot;epanechnikov&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Density&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-6"></span>
<img src="04-kde_files/figure-html/unnamed-chunk-6-1.png" alt="Kernel density plot of the age distribution using the Epanechnikov kernel. Changing the kernel has little effect on the estimation of the density; this plot looks almost identical to the density plot using the Gaussian kernel." width="50%" />
<p class="caption">
Figure 4: Kernel density plot of the age distribution using the Epanechnikov kernel. Changing the kernel has little effect on the estimation of the density; this plot looks almost identical to the density plot using the Gaussian kernel.
</p>
</div>
<p>Changing the kernel function uses a different shaped distribution to estimate the density at each observation. The methodological research literature suggests that the choice of the functional form of the kernel has little effect on the estimation of the density—all are essentially equivalently efficient in minimizing the error when approximating the true density <span class="citation">(e.g., Epanechnikov, <a href="#ref-epanechnikov">1969</a>; Silverman, <a href="#ref-silverman">1986</a>)</span>—and thus it is reasonable to simply use the default Gaussian kernel function.</p>
<p>Selecting the smoothing parameter is another matter. Change in the amount of variation in the kernel has a large effect on the appearance and interpretation of the density estimate. This is similar to forcing fewer or additional bins in the traditional histogram. The figure below shows the difference in appearance in the overall plot of the kernel density that is associated with changing the smoothing parameter. The three density estimates are based on the same sample of data, and all use the Gaussian kernel function. It can be seen that using a smoothing parameter of 0.5 produces an estimate of the density which is quite rough (left-hand plot), while using a smoothing parameter of 2 (middle plot) produces a smoother estimate. A smoothing parameter of 10 (right-hand plot) produces an even smoother plot. As the smoothing parameter increases, the density curve becomes smoother.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-7"></span>
<img src="04-kde_files/figure-html/unnamed-chunk-7-1.png" alt="Kernel density estimates using three different smoothing parameters. Each estimate used a Gaussian kernel. The estimate on the left used a smoothing parameter of 0.5. The estimate in the middle used a smoothing parameter of 2. The estimate on the right used a smoothing parameter of 10." width="90%" />
<p class="caption">
Figure 5: Kernel density estimates using three different smoothing parameters. Each estimate used a Gaussian kernel. The estimate on the left used a smoothing parameter of 0.5. The estimate in the middle used a smoothing parameter of 2. The estimate on the right used a smoothing parameter of 10.
</p>
</div>
<p>To set the smoothing parameter, we use the <code>bw=</code> argument in the <code>geom_density()</code> layer of the plot. For example, to set the smoothing parameter to 10, we would use the following syntax:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># Change smoothing parameter</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> vlss, <span class="kw">aes</span>(<span class="dt">x =</span> Age)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">bw =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Density&quot;</span>)</a></code></pre></div>
<p>If the researcher chooses a smoothing parameter that is too small, the density estimate will appear jagged, spuriously highlighting anomalies of the data such as asymmetry and multiple modes. Such features can appear because of chance variation rather than because they are structures present in the probability distribution. If the researcher chooses a smoothing parameter that is too large, she may obscure much of the structure in the data, a phenomenon known as oversmoothing. Ideally a smoothing parameter is chosen that is small enough to reveal detail in the graph but large enough to inhibit random noise.</p>
<p>Several methods have been proposed to choose an optimum smoothing parameter based on the data <span class="citation">(see Sheather, <a href="#ref-sheather">2004</a>)</span>. While these methods tend to compute smoothing parameters that perform well in simulation studies, for sample data that is substantially nonnormal, some manual adjustment may be required. The method that the <code>geom_density()</code> function uses to compute the value of the smoothing parameter is based on Silverman’s rule of thumb <span class="citation">(Silverman, <a href="#ref-silverman">1986</a>)</span>. The method popularized by Silverman—which was originally proposed for improved density estimation in histograms <span class="citation">(e.g., Deheuvels, <a href="#ref-deheuvels">1977</a>; Scott, <a href="#ref-scott">1979</a>)</span>—is a computationally simple method for choosing the smoothing parameter. The <code>geom_density()</code> function computes the density based on several popular methods:</p>
<ul>
<li>Silverman’s method (default); <code>bw="nrd0"</code></li>
<li>Scott’s method; <code>bw="nrd"</code></li>
<li>Sheather and Jones’ method; <code>bw="SJ"</code></li>
<li>Unbiased cross-validation; <code>bw="ucv"</code></li>
<li>Biased cross-validation; <code>bw="bcv"</code></li>
</ul>
<p>This actual value of the smoothing parameter can be obtained by employing the <code>density()</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Obtain smoothing parameter for Silverman&#39;s method</span></a>
<a class="sourceLine" id="cb7-2" title="2">d =<span class="st"> </span><span class="kw">density</span>(vlss<span class="op">$</span>Age, <span class="dt">bw =</span> <span class="st">&quot;nrd0&quot;</span>)</a>
<a class="sourceLine" id="cb7-3" title="3">d</a></code></pre></div>
<pre><code>## 
## Call:
##  density.default(x = vlss$Age, bw = &quot;nrd0&quot;)
## 
## Data: vlss$Age (28633 obs.); Bandwidth &#39;bw&#39; = 2.344
## 
##        x                 y            
##  Min.   : -7.033   Min.   :1.010e-07  
##  1st Qu.: 21.234   1st Qu.:1.410e-03  
##  Median : 49.500   Median :6.416e-03  
##  Mean   : 49.500   Mean   :8.836e-03  
##  3rd Qu.: 77.766   3rd Qu.:1.385e-02  
##  Max.   :106.033   Max.   :2.587e-02</code></pre>
<p>For Silverman’s method, the default used in the <code>geom_density()</code> function, the numerical value of the smoothing parameter for the age variable is 2.344. Although the default smoothing parameter in this case seems reasonable in providing a smooth plot, the prudent data analyst should try several smoothing parameters to ensure that the plot is not oversmoothed. The figure below shows the original plot, as well as additional kernel density plots using the Sheather and Jones method of computing the smoothing parameter. All the methods yield similar curves for the age variable.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-10"></span>
<img src="04-kde_files/figure-html/unnamed-chunk-10-1.png" alt="Kernel density estimates using Silverman's rule of thumb for the smoothing parameter (left-hand plot) and Sheather and Jones' method of computing the smoothing parameter, (right-hand plot)" width="90%" />
<p class="caption">
Figure 6: Kernel density estimates using Silverman’s rule of thumb for the smoothing parameter (left-hand plot) and Sheather and Jones’ method of computing the smoothing parameter, (right-hand plot)
</p>
</div>
<p><br /><br /></p>
</div>
<div id="adaptive-kernel-density-estimation" class="section level2">
<h2>Adaptive Kernel Density Estimation</h2>
<p>One promising method for computing the degree of smoothing is the use of <em>adaptive kernel estimation</em> <span class="citation">(e.g., Bowman &amp; Azzalini, <a href="#ref-bowman">1997</a>; Silverman, <a href="#ref-silverman">1986</a>; Terrell &amp; Scott, <a href="#ref-terrell2">1992</a>)</span>. This method seems especially well-suited for estimating densities of long-tailed or multi-modal data. Adaptive kernel density estimation allows the kernels to have differing widths. Varying the smoothing parameter reduces the potential of undersmoothing the density estimate where there are sparse data and also reduces the potential of oversmoothing the density estimate where there are heavy data.</p>
<p>Adaptive kernel densities can be estimated using the <code>akj()</code> function from the <strong>quantreg</strong> package. The <code>z=</code> argument takes an equispace sequence of values for which the density should be estimated. From the computations earlier, recall that the density object, <code>d</code>, contains a set of equispaced <span class="math inline">\(x\)</span>-values at which the density was estimated. These can be accessed using <code>d\$x</code>, which is then supplied to the <code>z=</code> argument in the <code>akj()</code> function. The estimated density is assigned to the object <code>adapt</code>. Because of the iterative method that adaptive kernel estimation uses, running the function can take some time depending on the computer’s processor and the size of the sample.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Create density plot using adaptive kernel density estimation</span></a>
<a class="sourceLine" id="cb9-2" title="2">adapt =<span class="st"> </span><span class="kw">akj</span>(<span class="dt">x =</span> vlss<span class="op">$</span>Age, <span class="dt">z =</span> d<span class="op">$</span>x) </a></code></pre></div>
<p>To plot this, we first dreate a data frame that includes the <em>x</em>-values used in the <code>z=</code> argument and the density estimates, stored in <code>adapt$dens</code>. Then we can use <code>geom_line()</code> to plot the actual density estimates.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Set up data frame</span></a>
<a class="sourceLine" id="cb10-2" title="2">density_est =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="dt">x =</span> d<span class="op">$</span>x,</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="dt">y =</span> adapt<span class="op">$</span>dens</a>
<a class="sourceLine" id="cb10-5" title="5">)</a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co"># Plot density estimates</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="kw">ggplot</span>(<span class="dt">data =</span> density_est, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Age&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Density&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-12"></span>
<img src="04-kde_files/figure-html/unnamed-chunk-12-1.png" alt="Density plot using adaptive kernel density estimation." width="50%" />
<p class="caption">
Figure 7: Density plot using adaptive kernel density estimation.
</p>
</div>
<p><br /><br /></p>
</div>
<div id="density-estimation-in-practice" class="section level2">
<h2>Density Estimation in Practice</h2>
<p>Unfortunately, there is no one uniform best method for choosing the smoothing parameter <span class="citation">(Simonoff, <a href="#ref-simonoff">1996</a>)</span>. <span class="citation">Terrell (<a href="#ref-terrell">1990</a>, p. 470)</span> asserts that “most density estimates are presumably designed on aesthetic grounds: The practitioner picks the smoothing parameter so that the density looks good. Clearly, though, such an individualistic approach does not lead to replicable results; nor does it lead reliably to sensible estimates from a novice.”</p>
<p>While researchers may make different analytic decisions about the choice of kernel and smoothing parameters, hopefully, the substantive findings about the research questions will not change (although it is possible that they may). For example, in all three methods of smoothing preseneted, the estimated kernel density shows that the population has three potential modes in the distribution. These likely refer to three distinct age groups or subpopulations. Each of these age groups has a higher density (taller distribution) and seems to have less variation (a thinner distribution) than the subsequent younger age group.</p>
<p>Regardless of the analytic decisions made, any statistical results presented need to include sufficient information included to judge the soundness of the conclusions drawn. This helps the researcher either verify or call into question what she is seeing from the analysis. There are two things to keep in mind:</p>
<ul>
<li>There is no “right” answer in statistical analysis <span class="citation">(Box, <a href="#ref-box2">1979</a>; Box &amp; Draper, <a href="#ref-box">1987</a>)</span> but only explanation and presentation.</li>
<li>There is a distinction between how most researchers do their analysis and how they present their results.</li>
</ul>
<p>When presenting results, researchers should integrate or synthesize information from the data analysis with the content and findings from the substantive literature. Relating the findings back to previous research helps the researcher evaluate her findings. The results might verify other findings or question them. The researcher might also question her own results if they are not consistent with expectations and other studies. Remember, the statistical analysis is used to inform the substantive area, and the writing should reflect this. An example of a write-up for the age distribution analysis might be as follows.</p>
<blockquote>
<p>The density for a sample of ages from <span class="math inline">\(N=28,633\)</span> Vietnamese citizens was estimated using an adaptive kernel method <span class="citation">(Portnoy &amp; Koenker, <a href="#ref-portnoy">1989</a>)</span>. The plot of the estimated kernel density reveals three potential subpopulations in the distribution which depict three distinct age groups: a younger, middle-aged, and older generation. The population pyramid based on the 1999 Vietnam census also seems to indicate the presence of three subpopulations <span class="citation">(General Statistical Office, <a href="#ref-gso">2001</a>)</span>. The overall positive skew in the distribution also suggests that the population of each subsequently higher age group has relatively lower frequency. Two other interesting features emerge in the density plot that have also been documented in the research literature <span class="citation">(e.g., Haughton et al., <a href="#ref-haughton">2001</a>)</span>. The second mode in the age distribution occurs near the age of 40. This mode has lower frequency in part because of lives lost during the Vietnam War, which ended in 1975 with the reunification of North and South Vietnam. One can also see the effect of decreasing fertility rates in the fact that estimated density decreases as ages decrease from about 16 to zero.</p>
</blockquote>
<!-- ## Variability Bands for Kernel Densities -->
<!-- One concern that is raised by using the density estimate in exploring univariate data is the need to evaluate which features of the density estimate indicate legitimate underlying structure and which can be attributable to random variation. For example, does the age variable actually contain three modes? Or, in particular, is the third mode attributable to chance variation produced by poor estimation of the density at those age values? One method of capturing the uncertainty associated with a density estimate is to create a *variability band* or *uncertainty envelope* around the density estimate. @wand argue that the graphical display of the variance structure can be helpful when determining if interesting features of the density are indeed part of the underlying structure in the population.  -->
<!-- As demonstrated by @bowman, variability bands around the density estimate, $\hat{p}(x)$, have the form  -->
<!-- $$ -->
<!-- \hat{p}(x) \pm 2 \times \mathrm{SE}_{\hat{p}(x)}, -->
<!-- $$ -->
<!-- where $\mathrm{SE}_{\hat{p}(x)}$ is the standard error computed from the variance estimate, which in turn is computed using a Taylor series approximation. @bowman have implemented functionality to compute and plot the density estimate along with variability bands in R, using the `sm.density()` function from the **sm** package. Within the `sm.density()` function, the argument `display="se"` indicates that variability bands are to be plotted along with the density estimate. The argument `h=` indicates the smoothing parameter to be used in the density estimation. The figure below shows the plotted density and variability bands for the subset of ages.  -->
<!-- ```{r echo=FALSE, message=FALSE, fig.cap="Kernel density estimate (solid line) with variability bands (dotted lines) for the distribution of ages for the Vietnamese population. A smoothing parameter of 4 was used in the density estimation.", fig.width=5, fig.height=4} -->
<!-- library(sm) -->
<!-- sm.density(vlss$Age, display = "se", xlab="Age", h = 4) -->
<!-- ``` -->
<!-- For example, the width of bands for the VLSS data strengthens the evidence that the troughs and peaks of the small wiggles seen in Figure \ref{fig:3-5} stay within each other's variability bands suggesting that there is no good evidence that the wiggles exist in the population. On the other hand, the different plateau near ages 35 and 70 are clearly distinct. -->
<p><br /><br /></p>

<div id="refs" class="references">
<div>
<p>Bowman, A., &amp; Azzalini, A. (1997). <em>Applied smoothing techniques for data analysis: The kernel approach with S-Plus illustrations</em>. Oxford University Press.</p>
</div>
<div>
<p>Box, G. E. P. (1979). Robustness in the strategy of scientific model building. In R. Launer &amp; G. Wilkinson (Eds.), <em>Robustness in statistics</em> (pp. 201–236). Academic Press.</p>
</div>
<div>
<p>Box, G. E. P., &amp; Draper, N. R. (1987). <em>Empirical model-building and response surfaces</em>. Wiley.</p>
</div>
<div>
<p>Deheuvels, P. (1977). Estimation nonparamètrique de la densitè par histogrammes gènèralisès. <em>Rivista Di Statistica Applicata</em>, <em>25</em>, 5–42.</p>
</div>
<div>
<p>Epanechnikov, V. A. (1969). Nonparametric estimation of a multivariate probability density. <em>Theory of Probability and Its Applications</em>, <em>14</em>, 153–158.</p>
</div>
<div>
<p>Freedman, D., &amp; Diaconis, P. (1981). On the histogram as a density estimator: <span class="math inline">\(\mathrm{L}_2\)</span> Theory. <em>Zeitschrift Für Wahrscheinlichkeitstheorie Und Verwandte Gebiete</em>, <em>57</em>, 453–476.</p>
</div>
<div>
<p>General Statistical Office. (2001). <em>Statistical yearbook</em>. Statistical Publishing House.</p>
</div>
<div>
<p>Haughton, D., Haughton, J., &amp; Phong, N. (2001). <em>Living standards during an economic boom: The case of vietnam</em>. Statistical Publishing House; United Nations Development Programme.</p>
</div>
<div>
<p>Portnoy, S., &amp; Koenker, R. (1989). Adaptive L estimation of linear models. <em>Annals of Statistics</em>, <em>17</em>, 362–381.</p>
</div>
<div>
<p>Rissanen, J., Speed, T., &amp; Yu, B. (1992). Density estimation by stochastic complexity. <em>IEEE Trans. On Information Theory</em>, <em>38</em>, 315–323.</p>
</div>
<div>
<p>Sain, S. R. (1994). <em>Adaptive kernel density estimation</em> [PhD thesis]. Rice University.</p>
</div>
<div>
<p>Scott, D. W. (1979). On optimal and data-based histograms. <em>Biometrika</em>, <em>66</em>, 605–610.</p>
</div>
<div>
<p>Sheather, S. J. (2004). Density estimation. <em>Statistical Science</em>, <em>19</em>(4), 588–597.</p>
</div>
<div>
<p>Silverman, B. W. (1986). <em>Density estimation for statistics and data analysis</em>. Chapman; Hall.</p>
</div>
<div>
<p>Simonoff, J. S. (1996). <em>Smoothing methods in statistics</em>. Springer.</p>
</div>
<div>
<p>Sturges, H. (1926). The choice of a class-interval. <em>Journal of the American Statistical Association</em>, <em>21</em>, 65–66.</p>
</div>
<div>
<p>Terrell, G. R. (1990). The maximal smoothing principle in density estimation. <em>Journal of the American Statistical Association</em>, <em>85</em>(410), 470–477.</p>
</div>
<div>
<p>Terrell, G. R., &amp; Scott, D. W. (1992). Variable kernel density estimation. <em>The Annals of Statistics</em>, <em>20</em>, 1236–1265.</p>
</div>
<div>
<p>Wand, M. P. (1997). Data-based choice of histogram bin width. <em>The American Statistician</em>, <em>51</em>, 59–64.</p>
</div>
<div>
<p>WorldBank. (1999). <em>World development indicators 1999</em>. CD-ROM; WorldBank.</p>
</div>
<div>
<p>Zieffler, A. S., Harring, J. R., &amp; Long, J. D. (2011). <em>Comparing groups: Randomization and bootstrap methods using R</em>. Wiley.</p>
</div>
</div>
</div>
</div>






<h3>References</h3>
<div id="refs" class="references">
<div id="ref-bowman">
<p>Bowman, A., &amp; Azzalini, A. (1997). <em>Applied smoothing techniques for data analysis: The kernel approach with S-Plus illustrations</em>. Oxford University Press.</p>
</div>
<div id="ref-box2">
<p>Box, G. E. P. (1979). Robustness in the strategy of scientific model building. In R. Launer &amp; G. Wilkinson (Eds.), <em>Robustness in statistics</em> (pp. 201–236). Academic Press.</p>
</div>
<div id="ref-box">
<p>Box, G. E. P., &amp; Draper, N. R. (1987). <em>Empirical model-building and response surfaces</em>. Wiley.</p>
</div>
<div id="ref-deheuvels">
<p>Deheuvels, P. (1977). Estimation nonparamètrique de la densitè par histogrammes gènèralisès. <em>Rivista Di Statistica Applicata</em>, <em>25</em>, 5–42.</p>
</div>
<div id="ref-epanechnikov">
<p>Epanechnikov, V. A. (1969). Nonparametric estimation of a multivariate probability density. <em>Theory of Probability and Its Applications</em>, <em>14</em>, 153–158.</p>
</div>
<div id="ref-freedman">
<p>Freedman, D., &amp; Diaconis, P. (1981). On the histogram as a density estimator: <span class="math inline">\(\mathrm{L}_2\)</span> Theory. <em>Zeitschrift Für Wahrscheinlichkeitstheorie Und Verwandte Gebiete</em>, <em>57</em>, 453–476.</p>
</div>
<div id="ref-gso">
<p>General Statistical Office. (2001). <em>Statistical yearbook</em>. Statistical Publishing House.</p>
</div>
<div id="ref-haughton">
<p>Haughton, D., Haughton, J., &amp; Phong, N. (2001). <em>Living standards during an economic boom: The case of vietnam</em>. Statistical Publishing House; United Nations Development Programme.</p>
</div>
<div id="ref-portnoy">
<p>Portnoy, S., &amp; Koenker, R. (1989). Adaptive L estimation of linear models. <em>Annals of Statistics</em>, <em>17</em>, 362–381.</p>
</div>
<div id="ref-rissanen">
<p>Rissanen, J., Speed, T., &amp; Yu, B. (1992). Density estimation by stochastic complexity. <em>IEEE Trans. On Information Theory</em>, <em>38</em>, 315–323.</p>
</div>
<div id="ref-sain">
<p>Sain, S. R. (1994). <em>Adaptive kernel density estimation</em> [PhD thesis]. Rice University.</p>
</div>
<div id="ref-scott">
<p>Scott, D. W. (1979). On optimal and data-based histograms. <em>Biometrika</em>, <em>66</em>, 605–610.</p>
</div>
<div id="ref-sheather">
<p>Sheather, S. J. (2004). Density estimation. <em>Statistical Science</em>, <em>19</em>(4), 588–597.</p>
</div>
<div id="ref-silverman">
<p>Silverman, B. W. (1986). <em>Density estimation for statistics and data analysis</em>. Chapman; Hall.</p>
</div>
<div id="ref-simonoff">
<p>Simonoff, J. S. (1996). <em>Smoothing methods in statistics</em>. Springer.</p>
</div>
<div id="ref-sturges">
<p>Sturges, H. (1926). The choice of a class-interval. <em>Journal of the American Statistical Association</em>, <em>21</em>, 65–66.</p>
</div>
<div id="ref-terrell">
<p>Terrell, G. R. (1990). The maximal smoothing principle in density estimation. <em>Journal of the American Statistical Association</em>, <em>85</em>(410), 470–477.</p>
</div>
<div id="ref-terrell2">
<p>Terrell, G. R., &amp; Scott, D. W. (1992). Variable kernel density estimation. <em>The Annals of Statistics</em>, <em>20</em>, 1236–1265.</p>
</div>
<div id="ref-wand2">
<p>Wand, M. P. (1997). Data-based choice of histogram bin width. <em>The American Statistician</em>, <em>51</em>, 59–64.</p>
</div>
<div id="ref-worldbank">
<p>WorldBank. (1999). <em>World development indicators 1999</em>. CD-ROM; WorldBank.</p>
</div>
<div id="ref-Zieffler:2011">
<p>Zieffler, A. S., Harring, J. R., &amp; Long, J. D. (2011). <em>Comparing groups: Randomization and bootstrap methods using R</em>. Wiley.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>There are several kernel functions that can be used in density estimation.<a href="kernel-density-estimation.html#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
<p style="text-align: center;">
<a href="creating-tables-to-present-statistical-results.html"><button class="btn btn-default">Previous</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
